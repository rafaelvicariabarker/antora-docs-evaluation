<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: devonfw Documentation</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">^
      <img class="toolbar-logo" src="../../_/img/Logo_devonfw.svg" viewBox="20 0 80 80"
        alt="Devonfw Logo">
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container"  data-component="cobigen" data-version="1.0">
  <div class="panels">
         <div class="nav-trees">
      <div class="version-box">
        <select data-component="cobigen" class="select-version">
            <option value="1.0">
              1.0
            </option>
        </select>
      </div>
        <div data-component="cobigen" data-version="1.0" class="hide">
          <div class="nav-item is-link">
              <button class="nav-item-toggle"></button>
            <a  class="" href="index.html">
              Cobigen
            </a>
          </div>
          <div class="nav-children-panel hide">
             
   
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Usage</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_usage">Usage of the eclipse UI</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#usage">OpenAPI Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/howto_ionic-client-generation">Ionic/Cordova Client Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/howto_angular-client-generation">Angular Client Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-maven_configuration">Usage in Maven Builds</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">Configuration of the Templates</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Installation</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_installation">For eclipse users</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Architecture</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki#architecture">CobiGen is build as an extensible framework for incremental code generation&#8230;&#8203;</a>              </div>
                  </div>
              </div>
        </div>
    </div>
    <div class="nav-trees">
      <div class="version-box">
        <select data-component="devon4j" class="select-version">
            <option value="1.0">
              1.0
            </option>
        </select>
      </div>
        <div data-component="devon4j" data-version="1.0" class="hide">
          <div class="nav-item is-link">
              <button class="nav-item-toggle"></button>
            <a  class="" href="../../devon4j/1.0/index.html">
              Devon4j
            </a>
          </div>
          <div class="nav-children-panel hide">
             
   
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Documentation</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/architecture.html">Architecture Overview</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-domain-layer.html">Domain Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-logic-layer.html">Logic Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-service-layer.html">Service Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-batch-layer.html">Batch Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-client-layer.html">Client Layer (GUI)</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Coding</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/coding-conventions.html">Coding Conventions</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/coding-tools.html">Development Tools</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Guides</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-dependency-injection.html">Bean Dependency Injection</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-configuration.html">Configuration</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-logging.html">Logging</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-exceptions.html">Exception Handling</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-i18n.html">Internationalization (I18N)</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-transferobject.html">Transferobjects</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-beanmapping.html">Bean-Mapping</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-datatype.html">Datatypes</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-xml.html">XML</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-json.html">JSON</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-rest.html">REST</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-soap.html">SOAP</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-service-client.html">Service Client</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-kafka.html">Kafka</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-validation.html">Validation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-security.html">Security</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-access-control.html">Access Control</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-testing.html">Testing</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-transactions.html">Transaction Handling</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-aop.html">AOP</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-jpa.html">JPA</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-repository.html">Repository</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-dao.html">DAO</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-jpa-query.html">Queries</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-jpa-performance.html">JPA Performance</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-auditing.html">Auditing</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-database-migration.html">Database Migration</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-accessibility.html">Accessibility</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-caching.html">Caching</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-cors-support.html">CORS support</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-blob-support.html">BLOB support</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-sql.html">SQL</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="../../devon4j/1.0/guide-apm.html">Application Performance Management</a>              </div>
                  </div>
              </div>
        </div>
    </div>
   </div>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>  <a href="../../devon4j/1.0/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/rafaelvicariabarker/cobigen/edit/refactorForAntora/modules/ROOT/pages/cobigen-core_development.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#cobigen-core-development">CobiGen Core Development</a>
<ul class="sectlevel1">
<li><a href="#extension-mechanism">Extension Mechanism</a></li>
<li><a href="#plugin-registry">Plugin Registry</a>
<ul class="sectlevel2">
<li><a href="#load-plugin">Load Plugin</a></li>
</ul>
</li>
<li><a href="#cobigen-initialization">CobiGen Initialization</a>
<ul class="sectlevel2">
<li><a href="#freemarker-initialization">FreeMarker Initialization</a></li>
<li><a href="#context-configuration">Context Configuration</a></li>
</ul>
</li>
<li><a href="#perform-generation">Perform Generation</a>
<ul class="sectlevel2">
<li><a href="#single-non-container-input">Single Non Container Input</a></li>
<li><a href="#single-container-input-or-multiple-files-selection">Single Container Input or multiple files selection</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="cobigen-core-development" class="sect0"><a class="anchor" href="#cobigen-core-development"></a>CobiGen Core Development</h1>
<div class="paragraph">
<p>CobiGen uses Apache FreeMarker as engine for generation through FreeMarker templates.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>To know more about development using Apache FreeMarker, please refer to <a href="http://freemarker.org/docs/pgui.html">official documentation</a>.</p>
</li>
<li>
<p>To know more about FreeMarker template development, please refer to the <a href="http://freemarker.org/docs/dgui.html">official template development documentation</a> and the guide of this wiki for each plugin:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-javaplugin">Java Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-xmlplugin">Xml Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-propertyplugin">Property Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-textmerger">Text Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-jsonplugin">JSON Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/cobigen/wiki/cobigen-templates_helpful-links">Helpful Links</a></p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The core implementation are divided in three projects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>cobigen-core-api</em></strong>: Mainly composed by interfaces that will be called from the Eclipse plug-in.</p>
</li>
<li>
<p><strong><em>cobigen-core</em></strong>: The implementation of the interfaces are within.</p>
</li>
<li>
<p><strong><em>cobigen-core-test</em></strong>: As the name suggests, used for test purposes.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="extension-mechanism"><a class="anchor" href="#extension-mechanism"></a>Extension Mechanism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>extension</strong> package from the <code>API</code> project contains the interfaces to be implemented if necessary by the sub plugins:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><em>`GeneratorPluginActivator.java`</em></strong></p>
</li>
<li>
<p><strong><em>`InputReader.java`</em></strong></p>
</li>
<li>
<p><strong><em>`MatcherInterpreter.java`</em></strong></p>
</li>
<li>
<p><strong><em>Merger.java</em></strong></p>
</li>
<li>
<p><strong><em>`TriggerInterpreter.java`</em></strong></p>
</li>
<li>
<p><strong><em>`ModelBuilder.java`</em></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>ModelBuilder</code> is an interface for accessing the internal model builder instance. Is implemented by <strong><em>`ModelBuilder.java`</em></strong> from the <strong>model</strong> package from the implementation project that provides the methods to call the <code>createModel()</code> from the correspondent input reader from the correspondent trigger interpreter to create the object models for a given object.</p>
</div>
<div class="paragraph">
<p>The <strong>to</strong> package have the transfer objects of <code>template</code>, <code>matcher</code>, <code>increment</code> and <code>variable assignment</code> classes that will be used as "communication channel" between the core and sub plug-ins methods</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="plugin-registry"><a class="anchor" href="#plugin-registry"></a>Plugin Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core must load all the sub plugins to get their Merger, Matcher, <code>TriggerInterpreter</code> and <code>InputReader</code>. That elements must implement their respective interfaces from the core.</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/howtos/cobigen-core/core_01.png"><img src="_images/images/howtos/cobigen-core/core_01.png" alt="Diagram 1" width="450"></a></span></p>
</div>
<div class="paragraph">
<p>Is important to note that not all the sub plug-ins need to have implemented a Matcher and/or an <code>InputReader</code> (advanced information <a href="https://github.com/devonfw/cobigen/wiki/new_plugin">here</a>)</p>
</div>
<div class="sect2">
<h3 id="load-plugin"><a class="anchor" href="#load-plugin"></a>Load Plugin</h3>
<div class="paragraph">
<p>The process of loading plugins to the core is done at the <a href="https://github.com/devonfw/cobigen/wiki/eclipse-plugin_development#1-1-activator-java">eclipse-plugin initialization</a>.</p>
</div>
<div class="paragraph">
<p>Each sub plugin has an activator class that extends the <strong><em>`GeneratorPluginActivator`</em></strong> interface from the <strong>extension</strong> package. That class implements the methods <code>bindMerger()</code> and <code>bindTriggerInterpreter()</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/howtos/cobigen-core/core_02.png"><img src="_images/images/howtos/cobigen-core/core_02.png" alt="Diagram 2" width="450"></a></span></p>
</div>
<div class="paragraph">
<p>This is the class passed as argument to the <code>loadPlugin()</code> method of <strong><em>`PluginRegister.java`</em></strong> of the <strong>pluginmanager</strong> package.</p>
</div>
<div class="paragraph">
<p>This method registers the mergers and the trigger interpreter of the sub plugins to the core.
The trigger interpreter has the correspondent input reader of the plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://github.com/devonfw/cobigen/wiki/new_plugin#3-adding-inputreader">How to add a new input reader</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cobigen-initialization"><a class="anchor" href="#cobigen-initialization"></a>CobiGen Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CobiGen initialization must initialize the context configuration and the FreeMarker configuration</p>
</div>
<div class="sect2">
<h3 id="freemarker-initialization"><a class="anchor" href="#freemarker-initialization"></a>FreeMarker Initialization</h3>
<div class="paragraph">
<p>When a CobiGen object is instantiated, the constructor initializes the Freemarker configuration creating a configuration instance from the class <strong>freemarker.template.Configuration</strong> and adjust its settings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">freeMarkerConfig = new Configuration(Configuration.VERSION_2_3_23);
freeMarkerConfig.setObjectWrapper(new DefaultObjectWrapperBuilder(Configuration.VERSION_2_3_23).build());
freeMarkerConfig.clearEncodingMap();
freeMarkerConfig.setDefaultEncoding("UTF-8");
freeMarkerConfig.setLocalizedLookup(false);
freeMarkerConfig.setTemplateLoader(new NioFileSystemTemplateLoader(`configFolder`));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code><strong><em>FileSystemUtil</em></strong></code> from the <strong>util</strong> package the <code>URI</code> of the root folder containing the <code>context.xml</code> and all templates, configurations etc&#8230;&#8203; is converted to a Path object passing it as argument to the <code><strong><em>ContextConfiguration</em></strong></code> constructor.
The <code><strong><em>ContextConfiguration</em></strong></code> creates a new <code>ContextConfiguration</code> from the <strong>config</strong> package with the contents initially loaded from the <code>context.xml</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>How the <code>ContextConfiguration</code> works explained deeply <a href="https://github.com/devonfw/cobigen/wiki/Core-Development#4-1-contextconfiguration">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Configuration initialization requires the version of FreeMarker to be used and at the <code>ObjectWrapper</code> initialization as well.
The <code><strong><em>DefaultObjectWrapperBuilder</em></strong></code> creates an <code><strong><em>DefaultObjectWrapper</em></strong></code> object that maps Java objects to the type-system of FreeMarker Template Language (<code>FTL</code>) with the given <code>incompatibleImprovements</code> specified by the version used as argument.</p>
</div>
<div class="paragraph">
<p>The configuration of FreeMarker requires to specify to a <em>`TemplateLoader`</em>. A <em>`TemplateLoader`</em> is an interface provided by FreeMarker library that the developer should implement to fit the needs. The <em>`TemplateLoader`</em> implementation at CobiGen is the class <strong><em>`NioFileSystemTemplateLoader.java`</em></strong> from the <strong>config.nio</strong> package.</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/howtos/cobigen-core/core_03.png"><img src="_images/images/howtos/cobigen-core/core_03.png" alt="Diagram 5" width="450"></a></span></p>
</div>
</div>
<div class="sect2">
<h3 id="context-configuration"><a class="anchor" href="#context-configuration"></a>Context Configuration</h3>
<div class="paragraph">
<p>The context configuration reads the <code>context.xml</code> file from the template project (default: <strong>CobiGen_Templates</strong>)  passing the path as argument to the constructor. At the constructor, it is created an instance of <code><strong><em>ContextConfigurationReader.java</em></strong></code> from the <strong>config.reader</strong> package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please, check the <a href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">CobiGen configuration</a> for extended information about the <code>context.xml</code> and <code>templates.xml</code> configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That reader uses the JAXB, JAXB (Java Architecture for XML Binding) provides a fast and convenient way to bind XML schemas and Java representations, making it easy for Java developers to incorporate XML data and processing functions in Java applications. As part of this process, JAXB provides methods for unmarshalling (reading) XML instance documents into Java content trees.</p>
</div>
<div class="sect3">
<h4 id="jaxb"><a class="anchor" href="#jaxb"></a>JAXB</h4>
<div class="paragraph">
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
JAXB auto generates the Java object within the <code>JAXBContext</code> specified at the <code>xmlns</code> attribute of the <code>contextConfiguration</code> field from the <code>context.xml</code> file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Unmarshaller unmarshaller = JAXBContext.newInstance(ContextConfiguration.class).createUnmarshaller();</code></pre>
</div>
</div>
<div class="paragraph">
<p>That auto-generation follows the <code>contextConfiguration.xsd</code> schema. Each Java object follows the template specified with the field <code>&lt;xs:CompleType&gt;</code> from the schema file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;xs:complexType name="trigger"&gt;
    &lt;xs:sequence&gt;
         &lt;xs:element name="containerMatcher" type="tns:containerMatcher" minOccurs="0" maxOccurs="unbounded"/&gt;
         &lt;xs:element name="matcher" type="tns:matcher" minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="id" use="required" type="xs:NCName"/&gt;
    &lt;xs:attribute name="type" use="required" type="xs:string"/&gt;
    &lt;xs:attribute name="templateFolder" use="required" type="xs:string"/&gt;
    &lt;xs:attribute name="inputCharset" use="optional" type="xs:string" default="UTF-8"/&gt;
 &lt;/xs:complexType&gt;
 &lt;xs:complexType name="matcher"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="variableAssignment" type="tns:variableAssignment" minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:attribute name="type" type="xs:string" use="required"/&gt;
    &lt;xs:attribute name="value" type="xs:string" use="required"/&gt;
    &lt;xs:attribute name="accumulationType" type="tns:accumulationType" use="optional" default="OR"/&gt;
  &lt;/xs:complexType&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="images/howtos/cobigen-core/cobigen-core_sshot1.png"><img src="_images/images/howtos/cobigen-core/cobigen-core_sshot1.png" alt="JAXB" width="450"></a></span></p>
</div>
<div class="paragraph">
<p>The generated Java objects has the elements and attributes specified at the schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = "trigger", namespace = "http://capgemini.com/devonfw/cobigen/ContextConfiguration", propOrder = {
    "containerMatcher",
    "matcher"
})
public class Trigger {
    @XmlElement(namespace = "http://capgemini.com/devonfw/cobigen/ContextConfiguration")
    protected List&lt;ContainerMatcher&gt; containerMatcher;
    @XmlElement(namespace = "http://capgemini.com/devonfw/cobigen/ContextConfiguration")
    protected List&lt;Matcher&gt; matcher;
    @XmlAttribute(name = "id", required = true)
    @XmlJavaTypeAdapter(CollapsedStringAdapter.class)
    @XmlSchemaType(name = "NCName")
    protected String id;
    @XmlAttribute(name = "type", required = true)
    protected String type;
    @XmlAttribute(name = "templateFolder", required = true)
    protected String templateFolder;
    @XmlAttribute(name = "inputCharset")
    protected String inputCharset;
    ...
    ..
    .
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This process it is done when calling the <code>unmarshal()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Object rootNode = unmarshaller.unmarshal(Files.newInputStream(contextFile));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For extended information about JAXB check the <a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/index.html">offical documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="version-validation"><a class="anchor" href="#version-validation"></a>Version Validation</h4>
<div class="paragraph">
<p>If the version retrieved after the <code>unmarshal</code> process is null, an <strong><code>InvalidConfigurationException</code></strong> defined at <strong>exceptions</strong> package will be thrown.</p>
</div>
<div class="paragraph">
<p>If it is not null, will be compared using the <code>validate()</code> method from <strong><em>`VersionValidator.java`</em></strong> from <strong>config.versioning</strong> package with the project version retrieved by the <strong><em>`MavenMetadata.java`</em></strong>. The <strong><em>`MavenMetadata.java`</em></strong> file is provided by the POM while building the <code>JAR</code> file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
    &lt;plugins&gt;
      &lt;!-- Inject Maven Properties in java-templates source folder --&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;templating-maven-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;generate-version-class&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;filter-sources&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
      ..
      .
    &lt;/plugins&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>MavenMetadata</code></strong> gets the current CobiGen version by reading the <code>&lt;version&gt;</code> label inside the <code>&lt;project&gt;</code> label from the POM file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MavenMetadata {
    /** Maven version */
    public static final String VERSION = "${project.version}";
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
  xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;artifactId&gt;cobigen-core&lt;/artifactId&gt;
  &lt;name&gt;CobiGen&lt;/name&gt;
  &lt;version&gt;2.2.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  ...
  ..
  .
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The comparison has three possibilities:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Versions are equal &#8594; Valid
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
</li>
<li>
<p><code>context.xml</code> version is greater than current CobiGen version &#8594; <strong><code>InvalidConfigurationException</code></strong></p>
</li>
<li>
<p>Current CobiGen version is greater that <code>context.xml</code> version &#8594; Compatible if there not exists a version step (breaking change) in between, otherwise, throw an error.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Reaching this point, the configuration version and root node has been validated. Unmarshal with schema checks for checking the correctness and give the user more hints to correct his failures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
ContextConfigurationVersion latestConfigurationVersion = ContextConfigurationVersion.getLatest();
try (
    InputStream schemaStream = getClass().getResourceAsStream("/schema/" + latestConfigurationVersion
                                                              + "/contextConfiguration.xsd");
    InputStream configInputStream = Files.newInputStream(contextFile)) {
    Schema schema = schemaFactory.newSchema(new StreamSource(schemaStream));
    unmarshaller.setSchema(schema);
    rootNode = unmarshaller.unmarshal(configInputStream);
    contextNode = (ContextConfiguration) rootNode;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="load-triggers-matchers-container-matcher-accumulation-types-and-variable-assignments"><a class="anchor" href="#load-triggers-matchers-container-matcher-accumulation-types-and-variable-assignments"></a>Load Triggers, Matchers, container Matcher, Accumulation Types and Variable Assignments</h4>
<div class="paragraph">
<p>To finish the context configuration initialization, the, trigger, matchers, container matchers, accumulation types and variables assignments are retrieved from the correspondent Java objects generated by JAXB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public Map&lt;String, Trigger&gt; loadTriggers()
private List&lt;Matcher&gt; loadMatchers(Trigger trigger)
private List&lt;ContainerMatcher&gt; loadContainerMatchers(Trigger trigger)
private List&lt;VariableAssignment&gt; loadVariableAssignments(Matcher matcher)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="perform-generation"><a class="anchor" href="#perform-generation"></a>Perform Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depending on the input, the generation process can begin from two different <code>generate()</code> methods called at the <code><strong>CobiGenWrapper</strong></code> from the eclipse-plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void generate(TemplateTo template, boolean forceOverride) throws IOException, TemplateException, MergeException {
    if (singleNonContainerInput) {
        Map&lt;String, Object&gt; model = cobiGen.getModelBuilder(inputs.get(0), template.getTriggerId()).createModel();
        adaptModel(model);
        cobiGen.generate(inputs.get(0), template, model, forceOverride);
    } else {
        for (Object input : inputs) {
            cobiGen.generate(input, template, forceOverride);
        }
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="single-non-container-input"><a class="anchor" href="#single-non-container-input"></a>Single Non Container Input</h3>
<div class="paragraph">
<p>If the input is a single non container input, first step is to create the model, then allow customization by the user (<code>adaptModel()</code>) and finally call the <code>generate()</code> method from CobiGen using the input, template, model and the boolean <code>forceOverride</code>.</p>
</div>
<div class="paragraph">
<p>The generation process in this case will follow this main steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the input is not null</p>
</li>
<li>
<p>Get the trigger interpreter for the type of the trigger of the template</p>
</li>
<li>
<p>Set the root folder for the templates to use for the generation</p>
</li>
<li>
<p>Get the input reader for the trigger interpreter retrieved</p>
</li>
<li>
<p>Test if the input is a package.<br>
This only can be possible in the case of java inputs. As the input is a single non container input, this check will fail and the execution will continue.</p>
</li>
<li>
<p>Check if the model parameter is null and if it is, create a new model<br>
As the model has been created at the <code><strong>CobiGenWrapper</strong></code>, there is no need to create it again.</p>
</li>
<li>
<p>Get the destination file.</p>
</li>
<li>
<p>Check if the destination file already exists<br>
If it exists, but the <code>forceOverride</code> is set to <code>true</code> or the merge strategy of the template is null, the file will be overwritten, not merged. Otherwise, first generate output into a writter object, get the merger and merge the original file with the writter and write the file with the merge result.</p>
</li>
<li>
<p>If the file does not exist, simple write the file.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="single-container-input-or-multiple-files-selection"><a class="anchor" href="#single-container-input-or-multiple-files-selection"></a>Single Container Input or multiple files selection</h3>
<div class="paragraph">
<p>The other case is, or the input is multiple files selection, the generation process will be performed for each individual file of the selection, but the model will be created at the step 6 of the steps of the Single Non Container Input and not allowing the user customization.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
