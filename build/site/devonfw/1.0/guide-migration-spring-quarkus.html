<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: devonfw Documentation</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">devonfw Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Cobigen</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Usage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_usage">Usage of the eclipse UI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#usage">OpenAPI Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_ionic-client-generation">Ionic/Cordova Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_angular-client-generation">Angular Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-maven_configuration">Usage in Maven Builds</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">Configuration of the Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_installation">For eclipse users</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki#architecture">CobiGen is build as an extensible framework for incremental code generation&#8230;&#8203;</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cobigen</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/rafaelvicariabarker/devon4j/edit/refactorForAntora/modules/ROOT/pages/guide-migration-spring-quarkus.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_migrate_from_spring_to_quarkus">Migrate from Spring to Quarkus</a></li>
<li><a href="#_create_the_quarkus_application">Create the Quarkus application</a>
<ul class="sectlevel2">
<li><a href="#_migration_toolkit_from_red_hat">Migration Toolkit from Red Hat</a></li>
</ul>
</li>
<li><a href="#_entities">Entities</a></li>
<li><a href="#_transfer_objects">Transfer objects</a></li>
<li><a href="#_data_access_layer">Data Access Layer</a></li>
<li><a href="#_logic_layer">Logic Layer</a></li>
<li><a href="#_mapping">Mapping</a></li>
<li><a href="#_service_layer">Service Layer</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_migrate_from_spring_to_quarkus"><a class="anchor" href="#_migrate_from_spring_to_quarkus"></a>Migrate from Spring to Quarkus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide will cover the migration process of a Spring application to a Quarkus application. There are already articles about migrating from Spring to Quarkus (e.g. <a href="https://developers.redhat.com/blog/2020/04/10/migrating-a-spring-boot-microservices-application-to-quarkus" class="bare">https://developers.redhat.com/blog/2020/04/10/migrating-a-spring-boot-microservices-application-to-quarkus</a>, <a href="https://dzone.com/articles/migrating-a-spring-boot-application-to-quarkus-cha" class="bare">https://dzone.com/articles/migrating-a-spring-boot-application-to-quarkus-cha</a>).
This guide will focus more on the devon4j specific aspects. We assume that a working Spring application exists, built in the <a href="guide-structure-classic.html" class="xref page">classic devon4j specific way</a> (e.g. <a href="https://github.com/devonfw/jump-the-queue/tree/master/java/jtqj">Jump The Queue</a> or <a href="https://github.com/devonfw/my-thai-star">My Thai Star</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_quarkus_application"><a class="anchor" href="#_create_the_quarkus_application"></a>Create the Quarkus application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We start with an empty Quarkus project. You can create the project with Maven on the command line or use the <a href="https://code.quarkus.io/">online generator</a>. The advantage of the online generator is that you have a pre-selection of dependencies to use in your project.
For starters, let&#8217;s select the basic dependencies needed to develop a REST service with database connectivity (you can use one of the links in the <a href="quarkus/quarkus-template.html" class="xref page">Quarkus template guide</a>): <em>RESTEasy JAX-RS, RESTEasy Jackson, Hibernate ORM, Spring Data JPA API, JDBC Driver (choose the type of database you need), Flyway (if you have database migration schemas), SmallRye Health (optional for Health Monitoring)</em></p>
</div>
<div class="paragraph">
<p>The list does not include all required dependencies. We will add more dependencies to the project later. So for now generate the application with these dependencies.</p>
</div>
<div class="sect2">
<h3 id="_migration_toolkit_from_red_hat"><a class="anchor" href="#_migration_toolkit_from_red_hat"></a>Migration Toolkit from Red Hat</h3>
<div class="paragraph">
<p>Red Hat provides a migration toolkit (<a href="https://developers.redhat.com/products/mta/overview">MTA, Migration Toolkit for Applications</a>), that supports you migrating a Spring application to a Quarkus application. There are several versions of this toolkit (e.g., a web console, a Maven plugin, or an IDE plugin).
The MTA analyzes your existing application and generates a report with hints and instructions for migrating from Spring to Quarkus. For example, it gives you an indication of which dependencies are not supported in your project for a Quarkus application and which dependencies you need to swap them with. The analysis is rule-based, and you can also add your own rules that will be checked during analysis.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_entities"><a class="anchor" href="#_entities"></a>Entities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is nothing special to consider when creating the entities. In most cases, you can simply take the code from your Spring application and use it for your Quarkus application. Usually, the entities extend a superclass <code>ApplicationPersistenceEntity</code> containing for example the <code>id</code> property. You can also take this class from your Spring application and reuse it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transfer_objects"><a class="anchor" href="#_transfer_objects"></a>Transfer objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next step is to create the appropriate transfer objects for the entities. In a devon4j Spring application, we would use CobiGen to create these classes. Since CobiGen is not usable for this purpose in Quarkus applications yet, we have to create the classes manually.</p>
</div>
<div class="paragraph">
<p>First we create some abstract base classes for the search criteria and DTO classes. Normally these would also be created by CobiGen.</p>
</div>
<div class="listingblock">
<div class="title"><strong>AbstractSearchCriteriaTo</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractSearchCriteriaTo extends AbstractTo {

  private static final long serialVersionUID = 1L;

  private Pageable pageable;

  //getter + setter for pageable
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>AbstractDto</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class AbstractDto extends AbstractTo {

  private static final long serialVersionUID = 1L;

  private Long id;

  private int modificationCounter;

  public AbstractDto() {

    super();
  }

  //getter + setter

  @Override
  protected void toString(StringBuilder buffer) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>AbstractTo</code>, the other classes extend, would be provided by the <a href="https://github.com/devonfw/devon4j/tree/master/modules/basic"><code>devon4j-basic</code></a> module in a devon4j Spring application. You can take the code from <a href="https://github.com/devonfw/devon4j/blob/master/modules/basic/src/main/java/com/devonfw/module/basic/common/api/to/AbstractTo.java">here</a> and reuse it in your Quarkus project.</p>
</div>
<div class="paragraph">
<p>Now you can create your transfer objects. Most of the code of the transfer objects of your Spring application should be reusable. For Quarkus, we recommend (as mentioned <a href="guide-dto.html" class="xref page">here</a>) to use <code>*Dto</code> instead of <code>*Eto</code> classes. So be sure to change the names of the classes accordingly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_access_layer"><a class="anchor" href="#_data_access_layer"></a>Data Access Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In devon4j, we propose to use <a href="guide-repository.html" class="xref page">Spring Data JPA</a> to build the data access layer using repositories and QueryDSL to build <a href="guide-jpa-query.html#dynamic-queries" class="xref page">dynamic queries</a>. We will also use this approach for Quarkus applications, but we need to change the implementation because the devon4j modules are based on reflection, which is not suitable for Quarkus.
In Quarkus we will use Querydsl using code generation. So for this layer, more changes are required and we can&#8217;t just take the existing code.</p>
</div>
<div class="paragraph">
<p>First, create a repository interface for your entity class that extends <code>JpaRepository</code> (see <a href="guide-repository.html#repository" class="xref page">here</a>).</p>
</div>
<div class="paragraph">
<p>To add QueryDSL support to your project, add the following dependencies to your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="title"><strong>pom.xml</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
  &lt;artifactId&gt;querydsl-jpa&lt;/artifactId&gt;
  &lt;version&gt;4.3.1&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
  &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
  &lt;version&gt;4.3.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, we will use QueryDSL with code generation. For this, add the QueryDSL annotation processor to your plugins:</p>
</div>
<div class="listingblock">
<div class="title"><strong>pom.xml</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugins&gt;
...
  &lt;plugin&gt;
    &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt;
    &lt;artifactId&gt;apt-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.1.3&lt;/version&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;phase&gt;generate-sources&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;process&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;outputDirectory&gt;target/generated-sources/annotations&lt;/outputDirectory&gt;
          &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To implement the queries, follow the <a href="guide-jpa-query.html#dynamic-queries" class="xref page">corresponding guide</a>.</p>
</div>
<div class="paragraph">
<p>Set the following properties in the application.properties file to configure the connection to your database (see also <a href="quarkus/guide-quarkus-configuration.html#database-configuration" class="xref page">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.datasource.db-kind=...
quarkus.datasource.jdbc.url=...
quarkus.datasource.username=...
quarkus.datasource.password=...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logic_layer"><a class="anchor" href="#_logic_layer"></a>Logic Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the logic layer, devon4j uses a <a href="guide-usecase.html" class="xref page">use-case approach</a>. You can reuse the use case interfaces from the api module of the Spring application. Again, make sure to rename the transfer objects.</p>
</div>
<div class="paragraph">
<p>Create the appropriate class that implements the interface. Follow the <a href="guide-usecase.html#implementation" class="xref page">implementation section</a> of the use-case guide to implement the methods. For mapping the entities to the corresponding transfer objects, see the next section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapping"><a class="anchor" href="#_mapping"></a>Mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For bean mapping, we need to use a completely different approach in the Quarkus application than in the Spring application. For Quarkus, we use MapStruct, which creates the mapper at build time rather than at runtime using reflection. Add the following dependencies to your pom.xml.</p>
</div>
<div class="listingblock">
<div class="title"><strong>pom.xml</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
  &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;
  &lt;version&gt;1.4.2.Final&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;
  &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;
  &lt;version&gt;1.4.2.Final&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can create the mapper as follows:</p>
</div>
<div class="listingblock">
<div class="title"><strong>Mapper</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Mapper(componentModel = "cdi")
public interface YourEntityMapper {
  YourEntityDto map(YourEntity entity);

  YourEntity map(YourEntityDto dto);

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inject the mapper into your use-case implementation and simply use the methods. The method implementations of the mapper are created when the application is built.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_layer"><a class="anchor" href="#_service_layer"></a>Service Layer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the implementation of the service layer, we use the <a href="guide-rest#jax-rs">JAX-RS</a> for both Quarkus and Spring applications to create the REST services. Classic devon4j Spring applications rely on Apache CFX as the implemention of JAX-RS.
For Quarkus, we use RESTEasy. Since both are implementations of JAX-RS, much of the Spring application code can be reused.</p>
</div>
<div class="paragraph">
<p>Take the definition of the REST endpoints from the api module of the Spring application (make sure to rename the transfer objects), inject the use-cases from the logic layer and use them in the REST service methods as follows:</p>
</div>
<div class="listingblock">
<div class="title"><strong>REST service</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/path/v1")
public class YourComponentRestService {

  @Inject
  UcFindYourEntity ucFindYourEntity;

  @Inject
  UcManageYourEntity ucManageYourEntity;

  @GET
  @Path("/yourEntity/{id}/")
  public YourEntityDto getYourEntity(@PathParam("id") long id);

    return this.ucFindYourEntity.findYourEntity(id);
  }

  ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you have seen, some parts hardly differ when migrating a Spring application to a Quarkus application, while other parts differ more. The above sections describe the parts needed for simple applications that provide REST services with a data access layer.
If you add more functionality, more customization and other frameworks/dependencies may be required. If that is the case, take a look at the corresponding guide on the topic in the devon4j documentation or check if there is a tutorial on the official <a href="https://quarkus.io/guides/">Quarkus website</a>.</p>
</div>
<div class="paragraph">
<p>Furthermore, we can summarize that migrating from a Spring application to a Quarkus representative is not complex. Although Quarkus is a very young framework (release 1.0 was in 2019), it brings a lot of proven standards and libraries that you can integrate into your application.
This makes it easy to migrate and reuse code from existing (Spring) applications. Also, Quarkus comes with Spring API compatibility for many Spring modules (<a href="https://quarkus.io/guides/spring-data-jpa">Spring Data JPA</a>, <a href="https://quarkus.io/guides/spring-di">Spring DI</a>, <a href="https://github.com/quarkusio/quarkus/tree/main/extensions">etc.</a>), which makes it easier for developers to reuse their knowledge.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
