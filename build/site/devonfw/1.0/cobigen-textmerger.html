<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: devonfw Documentation</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">devonfw Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Cobigen</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Usage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_usage">Usage of the eclipse UI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#usage">OpenAPI Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_ionic-client-generation">Ionic/Cordova Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_angular-client-generation">Angular Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-maven_configuration">Usage in Maven Builds</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">Configuration of the Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_installation">For eclipse users</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki#architecture">CobiGen is build as an extensible framework for incremental code generation&#8230;&#8203;</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cobigen</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/rafaelvicariabarker/cobigen/edit/refactorForAntora/modules/ROOT/pages/cobigen-textmerger.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_text_merger_plug_in">Text Merger Plug-in</a>
<ul class="sectlevel1">
<li><a href="#extensions">Merger extensions</a></li>
<li><a href="#_anchor_functionality">Anchor functionality</a>
<ul class="sectlevel2">
<li><a href="#_anchor_definition">Anchor Definition</a></li>
<li><a href="#_document_parts">Document parts</a></li>
<li><a href="#_mergestrategies"><code>Mergestrategies</code></a></li>
</ul>
</li>
<li><a href="#_usage_examples">Usage Examples</a>
<ul class="sectlevel2">
<li><a href="#_general">General</a></li>
<li><a href="#_merging">Merging</a></li>
</ul>
</li>
<li><a href="#_error_list">Error List</a></li>
</ul>
</li>
</ul>
</div>
<!-- toc disabled -->
<h1 id="_text_merger_plug_in" class="sect0"><a class="anchor" href="#_text_merger_plug_in"></a>Text Merger Plug-in</h1>
<div class="paragraph">
<p>The Text Merger Plug-in enables merging result free text documents to existing free text documents. Therefore, the algorithms are also very rudimentary.</p>
</div>
<div class="sect1">
<h2 id="extensions"><a class="anchor" href="#extensions"></a>Merger extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are currently three main merge strategies that apply for the whole document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>merge strategy <code>textmerge_append</code> (appends the text directly to the end of the existing document)
_Remark_: If no anchors are defined, this will simply append the patch.</p>
</li>
<li>
<p>merge strategy <code>textmerge_appendWithNewLine</code> (appends the text after adding a new line break to the existing document)
_Remark_: empty patches will not result in appending a new line any more since v1.0.1
<em>Remark</em>: Only suitable if no anchors are defined, otherwise it will simply act as <code>textmerge_append</code></p>
</li>
<li>
<p>merge strategy <code>textmerge_override</code> (replaces the contents of the existing file with the patch)
_Remark_: If anchors are defined, override is set as the default <code>mergestrategy</code> for every text block if not redefined in an anchor specification.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_anchor_functionality"><a class="anchor" href="#_anchor_functionality"></a>Anchor functionality</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a template contains text that fits the definition of <code>anchor:${documentpart}:${mergestrategy}:anchorend</code> or more specifically the regular expression <code>(.*)anchor:([<sup>:]+):(newline_)?([</sup>:]+)(_newline)?:anchorend\\s*(\\r\\n|\\r|\\n)</code>, some additional functionality becomes available about specific parts of the incoming text and the way it will be merged with the existing text. These anchors always change things about the text to come up until the next anchor, text before it is ignored.</p>
</div>
<div class="paragraph">
<p>If no anchors are defined, the complete patch will be appended depending on your choice for the template in the file <code>templates.xml</code>.</p>
</div>
<div class="paragraph">
<p>[[<code>anchordef</code>]]</p>
</div>
<div class="sect2">
<h3 id="_anchor_definition"><a class="anchor" href="#_anchor_definition"></a>Anchor Definition</h3>
<div class="paragraph">
<p>Anchors should always be defined as a comment of the language the template results in, as you do not want them to appear in your readable version, but cannot define them as freemarker comments in the template, or the merger will not know about them.
Anchors will also be read when they are not comments due to the merger being able to merge multiple types of text-based languages, thus making it practically impossible to filter for the correct comment declaration. <strong>That is why anchors have to always be followed by line breaks</strong>. That way there is a universal way to filter anchors that should have anchor functionality and ones that should appear in the text.
<em>Remark:</em> If the resulting language has closing tags for comments, they have to appear in the next line.
<em>Remark:</em> If you do not put the anchor into a new line, all the text that appears before it will be added to the anchor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_document_parts"><a class="anchor" href="#_document_parts"></a>Document parts</h3>
<div class="paragraph">
<p>In general, <code>${documentpart}</code> is an id to mark a part of the document, that way the merger knows what parts of the text to merge with which parts of the patch (e.g. if the existing text contains <code>anchor:table:${}:anchorend</code> that part will be merged with the part tagged <code>anchor:table:${}:anchorend</code> of the patch).</p>
</div>
<div class="paragraph">
<p>If the same <code>documentpart</code> is defined multiple times, it can lead to errors, so instead of defining <code>table</code> multiple times, use <code>table1</code>, <code>table2</code>, <code>table3</code> etc.</p>
</div>
<div class="paragraph">
<p>If a <code>${documentpart}</code> is defined in the document but not in the patch and they are in the same position, it is processed in the following way: If only the <code>documentparts header</code>, <code>test</code> and <code>footer</code> are defined in the document in that order, and the patch contains <code>header</code>, <code>order</code> and <code>footer</code>, the resulting order will be <code>header</code>, <code>test</code>, <code>order</code> then <code>footer</code>.</p>
</div>
<div class="paragraph">
<p>The following <code>documentparts</code> have default functionality:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>anchor:header:${mergestrategy}:anchorend</code> marks the beginning of a header, that will be added once when the document is created, but not again.
<em>Remark:</em> This is only done once, if you have <code>header</code> in another anchor, it will be ignored</p>
</li>
<li>
<p><code>anchor:footer:${mergestrategy}:anchorend</code> marks the beginning of a footer, that will be added once when the document is created, but not again. Once this is invoked, all following text will be included in the footer, including other anchors.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>[[<code>mergestrategies</code>]]</p>
</div>
</div>
<div class="sect2">
<h3 id="_mergestrategies"><a class="anchor" href="#_mergestrategies"></a><code>Mergestrategies</code></h3>
<div class="paragraph">
<p><code>Mergestrategies</code> are only relevant in the patch, as the merger is only interested in how text in the patch should be managed, not how it was managed in the past.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>anchor:${documentpart}::anchorend</code> will use the merge strategy from templates.xml, see <a href="#extensions">Merger-Extensions</a>.</p>
</li>
<li>
<p><code>anchor:${}:${mergestrategy}_newline:anchorend</code> or <code>anchor:${}:newline_${mergestrategy}:anchorend</code> states that a new line should be appended before or after this anchors text, depending on where the newline is (before or after the <code>mergestrategy</code>). <code>anchor:${documentpart}:newline:anchorend</code> puts a new line after the anchors text.
<em>Remark:</em> Only works with appending strategies, not merging/replacing ones. These strategies currently include: <code>appendbefore</code>, <code>append</code>/<code>appendafter</code></p>
</li>
<li>
<p><code>anchor:${documentpart}:override:anchorend</code> means that the new text of this <code>documentpart</code> will replace the existing one completely</p>
</li>
<li>
<p><code>anchor:${documentpart}:appendbefore:anchorend</code> or <code>anchor:${documentpart}:appendafter:anchorend</code>/<code>anchor:${documentpart}:append:anchorend</code> specifies whether the text of the patch should come before the existing text or after.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage_examples"><a class="anchor" href="#_usage_examples"></a>Usage Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general"><a class="anchor" href="#_general"></a>General</h3>
<div class="paragraph">
<p>Below you can see how a file with anchors might look like (using Asciidoc comment tags), with examples of what you might want to use the different functions for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// anchor:header:append:anchorend

Table of contents
Introduction/Header

// anchor:part1:appendafter:anchorend

Lists
Table entries

// anchor:part2:nomerge:anchorend

Document Separators
Asciidoc table definitions

// anchor:part3:override:anchorend

Anything that you only want once but changes from time to time

// anchor:footer:append:anchorend

Copyright Info
Imprint</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_merging"><a class="anchor" href="#_merging"></a>Merging</h3>
<div class="paragraph">
<p>In this section you will see a comparison on what files look like before and after merging</p>
</div>
<div class="sect3">
<h4 id="_override"><a class="anchor" href="#_override"></a>override</h4>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Lorem Ipsum</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Patch</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Dolor Sit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre>// anchor:part:override:anchorend
Dolor Sit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_appending"><a class="anchor" href="#_appending"></a>Appending</h4>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Lorem Ipsum
// anchor:part2:appendafter:anchorend
Lorem Ipsum
// anchor:part3:appendbefore:anchorend
Lorem Ipsum</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Patch</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Dolor Sit
// anchor:part2:appendafter:anchorend
Dolor Sit
// anchor:part3:appendbefore:anchorend
Dolor Sit</pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre>// anchor:part:append:anchorend
Lorem Ipsum
Dolor Sit
// anchor:part2:appendafter:anchorend
Lorem Ipsum
Dolor Sit
// anchor:part3:appendbefore:anchorend
Dolor Sit
Lorem Ipsum</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_newline"><a class="anchor" href="#_newline"></a>Newline</h4>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Lorem Ipsum
// anchor:part:append_newline:anchorend
Lorem Ipsum
(end of file)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Patch</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Dolor Sit
// anchor:part:append_newline:anchorend
Dolor Sit
(end of file)</pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre>// anchor:part:newline_append:anchorend
Lorem Ipsum

Dolor Sit
// anchor:part:append_newline:anchorend
Lorem Ipsum
Dolor Sit

(end of file)</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_error_list"><a class="anchor" href="#_error_list"></a>Error List</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>If there are anchors in the text, but either base or patch do not start with one, the merging process will be aborted, as text might go missing this way.</p>
</li>
<li>
<p>Using <code>_newline</code> or <code>newline_</code> with <code>mergestrategies</code> that don&#8217;t support it , like <code>override</code>, will abort the merging process. See &lt;&lt;`mergestrategies`,Merge Strategies&gt;&gt; &#8594;2 for details.</p>
</li>
<li>
<p>Using undefined <code>mergestrategies</code> will abort the merging process.</p>
</li>
<li>
<p>Wrong anchor definitions, for example <code>anchor:${}:anchorend</code> will abort the merging process, see &lt;&lt;`anchordef`,Anchor Definition&gt;&gt; for details.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
