<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: devonfw Documentation</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">devonfw Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="devonfw" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Cobigen</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Usage</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_usage">Usage of the eclipse UI</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#usage">OpenAPI Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_ionic-client-generation">Ionic/Cordova Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/howto_angular-client-generation">Angular Client Generation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-maven_configuration">Usage in Maven Builds</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">Configuration of the Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_installation">For eclipse users</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://github.com/devonfw/cobigen/wiki#architecture">CobiGen is build as an extensible framework for incremental code generation&#8230;&#8203;</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cobigen</span>
    <span class="version">1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Cobigen</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/rafaelvicariabarker/cobigen/edit/refactorForAntora/modules/ROOT/pages/howto_create-a-new-plugin.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_implementing_a_new_plug_in">Implementing a new Plug-in</a>
<ul class="sectlevel1">
<li><a href="#_plugin_activator">Plugin Activator</a></li>
<li><a href="#_adding_trigger_interpreter">Adding Trigger Interpreter</a></li>
<li><a href="#_adding_input_reader">Adding Input Reader</a>
<ul class="sectlevel2">
<li><a href="#_input_reader_interface">Input Reader Interface</a></li>
<li><a href="#_model_constants">Model Constants</a></li>
<li><a href="#_registering_the_input_reader">Registering the Input Reader</a></li>
</ul>
</li>
<li><a href="#_adding_matcher">Adding Matcher</a></li>
<li><a href="#_adding_merger">Adding Merger</a></li>
<li><a href="#_changes_since_eclipse_maven_3_x">Changes since Eclipse / Maven 3.x</a>
<ul class="sectlevel2">
<li><a href="#_deployment">Deployment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="_implementing_a_new_plug_in" class="sect0"><a class="anchor" href="#_implementing_a_new_plug_in"></a>Implementing a new Plug-in</h1>
<div class="paragraph">
<p>New plug-ins can implement an input reader, a merger, a matcher, a trigger interpreter, and/or a template engine as explained <a href="cobigen-core_development#extension-mechanism">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is discouraged to have <code>cobigen-core</code> dependencies at runtime, except for <code>cobigen-core-api</code> which definitely must be present.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_plugin_activator"><a class="anchor" href="#_plugin_activator"></a>Plugin Activator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each plug-in has to have an plug-in activator class implementing the interface <code>GeneratorPluginActivator</code> from the core-api. This class will be used to load the plug-in using the <code>PluginRegistry</code> as explained <a href="cobigen-core_development#loadplugin">here</a>. This class implements two methods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>bindMerger()</code> &#8594; returns a mapping of merge strategies and its implementation to be registered.</p>
</li>
<li>
<p><code>bindTriggerInterpreter()</code>&#8594; returns the trigger interpreters to be provided by this plug-in.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both methods create and register instances of mergers and trigger interpreters to be provided by the new plug-in.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_trigger_interpreter"><a class="anchor" href="#_adding_trigger_interpreter"></a>Adding Trigger Interpreter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The trigger interpreter has to implement the <code>TriggerInterpreter</code> interface from the core. The trigger interpreter defines the type for the new plugin and creates new <code>InputReader</code> and new Matcher objects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_input_reader"><a class="anchor" href="#_adding_input_reader"></a>Adding Input Reader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The input reader is responsible of read the input object and parse it into
 FreeMarker models. The input reader must be implemented for the type of the
 input file. If there is any existent plugin that has the same file type as input,
 there will be no need to add a new input reader to the new plug-in.</p>
</div>
<div class="sect2">
<h3 id="_input_reader_interface"><a class="anchor" href="#_input_reader_interface"></a>Input Reader Interface</h3>
<div class="paragraph">
<p>The interface needed to add a new input reader is defined at the core. Each new
sub plug-in must implements this interface if is needed an input reader for it.</p>
</div>
<div class="paragraph">
<p>The interface implements the basic methods that an input reader must have,
but if additional methods are required, the developer must add a new interface
that extends the original interface <strong><em>`InputReader.java`</em></strong> from the core-api
and implement that on the sub plug-in.</p>
</div>
<div class="paragraph">
<p>The methods to be implemented by the input reader of the new sub plugin are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isValidInput(Object input)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This function will be called if matching triggers or matching templates should be retrieved for a given input object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createModel(Object input)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Map&lt;String, Object&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This function should create the FreeMarker object model from the given input.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>combinesMultipleInputObjects(Object input)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">States whether the given input object combines multiple input objects to be used for generation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getInputObjects(Object input, Charset inputCharset)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>List&lt;Object&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will return the set of combined input objects if the given input combines multiple input objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTemplateMethods(Object input)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Map&lt;String, Object&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method returns available template methods from the plugins as Map. If the plugin which corresponds to the input does not provide any template methods an empty Map will be returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getInputObjectsRecursively(Object input, Charset inputCharset)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>List&lt;Object&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Will return the set of combined input objects if the given input combines multiple input objects.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_model_constants"><a class="anchor" href="#_model_constants"></a>Model Constants</h3>
<div class="paragraph">
<p>The Input reader will create a model for FreeMarker. A Freemarker model must
have variables to use them at the <code>.ftl</code> template file. Refer to <a href="cobigen-javaplugin#java-input-reader">Java Model</a> to see the FreeMarker model example for java input files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_registering_the_input_reader"><a class="anchor" href="#_registering_the_input_reader"></a>Registering the Input Reader</h3>
<div class="paragraph">
<p>The input reader is an object that can be retrieved using the correspondent get
 method of the trigger interpreter object. The trigger interpreter object is
 loaded at the eclipse plug-in using the load plug-in method explained
 <a href="cobigen-core_development#loadplugin">here</a>.
 That way, when the core needs the input reader, only needs to call that <code>getInputReader</code> method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_matcher"><a class="anchor" href="#_adding_matcher"></a>Adding Matcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The matcher implements the <code>MatcherInterpreter</code> interface from the core-api.
Should be implemented for providing a new input matcher. Input matcher are
defined as part of a trigger and provide the ability to restrict specific
inputs to a set of templates.
This restriction is implemented with a <code>MatcherType</code> <code>enum</code>.</p>
</div>
<div class="paragraph">
<p>E.g <code>JavaPlugin</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private enum MatcherType {
    /** Full Qualified Name Matching */
    FQN,
    /** Package Name Matching */
    PACKAGE,
    /** Expression interpretation */
    EXPRESSION
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Furthermore, matchers may provide several variable assignments, which might be
dependent on any information of the matched input and thus should be resolvable
by the defined matcher.</p>
</div>
<div class="paragraph">
<p>E.g <code>JavaPlugin</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private enum VariableType {
    /** Constant variable assignment */
    CONSTANT,
    /** Regular expression group assignment */
    REGEX
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_merger"><a class="anchor" href="#_adding_merger"></a>Adding Merger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The merger is responsible to perform merge action between new output with the
existent data at the file if it already exists. Must implement the Merger
interface from the core-api.
The implementation of the Merge interface must override the following methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getType()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the type, this merger should handle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>merge(File base, String patch, String targetCharset)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>String</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merges the patch into the base file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Is important to know that any exception caused by the merger must throw a <code>MergeException</code> from the core-api to the eclipse-plugin handle it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changes_since_eclipse_maven_3_x"><a class="anchor" href="#_changes_since_eclipse_maven_3_x"></a>Changes since Eclipse / Maven 3.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since version 3.x the Eclipse and Maven plugins of CobiGen utilize the Java <code>ServiceLoader</code> mechanic to find and register plugins at runtime. To enable a new plugin to be discovered by this mechanic the following steps are needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create the file <code>META-INF/services/com.devonfw.cobigen.api.extension.GeneratorPluginActivator</code> containing just the full qualified name of the class implementing the <code>GeneratorPluginActivator</code> interface, if the plugin provides a <code>Merger</code> and/or a <code>TriggerInterpreter</code></p>
</li>
<li>
<p>create the file <code>META-INF/services/com.devonfw.cobigen.api.extension.TextTemplateEngine</code> containing just the full qualified name of the class implementing the <code>TextTemplateEngine</code> interface, if provided by the plugin</p>
</li>
<li>
<p>include <code>META-INF</code> into the target bundle (i.e. the folder <code>META-INF</code> has to be present in the target jar file)</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Example: Java Plugin</div>
<div class="paragraph">
<p>The java plugin provides both a <code>Merger</code> and a <code>TriggerInterpreter</code>. It contains therefore a <code>com.devonfw.cobigen.api.extension.GeneratorPluginActivator</code> file with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">com.devonfw.cobigen.javaplugin.JavaPluginActivator</code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes the <code>JavaPluginActivator</code> class discoverable by the <code>ServiceLoader</code> at runtime.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>to properly include the plugin into the current system and use existing infrastructure, you need to add the plugin as a module in <code>/cobigen/pom.xml</code> (in case of a <code>Merger</code>/<code>TriggerInterpreter</code> providing plugin) and declare that as the plugin&#8217;s parent in it&#8217;s own <code>pom.xml</code> via</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;parent&gt;
    &lt;groupId&gt;com.devonfw&lt;/groupId&gt;
    &lt;artifactId&gt;cobigen-parent&lt;/artifactId&gt;
    &lt;version&gt;dev-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>or <code>/cobigen/cobigen-templateengines/pom.xml</code> (in case of a <code>Merger</code>/<code>TriggerInterpreter</code> providing plugin) and declare that as the plugin&#8217;s parent in it&#8217;s own <code>pom.xml</code> via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parent&gt;
    &lt;groupId&gt;com.devonfw&lt;/groupId&gt;
    &lt;artifactId&gt;cobigen-tempeng-parent&lt;/artifactId&gt;
    &lt;version&gt;dev-SNAPSHOT&lt;/version&gt;
&lt;/parent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the plugin provides both just use the <code>/cobigen/pom.xml</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The dependencies of the plugin are included in the bundle</p>
</li>
<li>
<p>To make the plugin available to the Eclipse plugin it must be included into the current <code>compositeContent.xml</code> and <code>compositeArtifacts.xml</code> files. Both files are located in <a href="https://github.com/devonfw/cobigen/tree/gh-pages/updatesite/stable"><code>https://github.com/devonfw/cobigen/tree/gh-pages/updatesite/{test|stable}</code></a>. To do so, add an <code>&lt;child&gt;</code> entry to the <code>&lt;children&gt;</code> tag in both files and adapt the <code>size</code> attribute to match the new number of references. The <code>location</code> attribute of the new <code>&lt;child&gt;</code> tag needs to be the artifact id of the plugins <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Example: Java Plugin</div>
<div class="paragraph">
<p>In case of the Java plugin, the entry is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;child location="cobigen-javaplugin"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deployment"><a class="anchor" href="#_deployment"></a>Deployment</h3>
<div class="paragraph">
<p>If you want to create a test release of eclipse you need to run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sh deploy.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>on the cloned cobigen repository while making sure, that your current version of cobigen cloned is a snapshot version. This will automatically be detected by the deploy script.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
