<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: devonfw Documentation</title>
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">^
      <img class="toolbar-logo" src="../../_/img/Logo_devonfw.svg" viewBox="20 0 80 80"
        alt="Devonfw Logo">
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container"  data-component="devon4j" data-version="1.0">
  <div class="panels">
         <div class="nav-trees">
      <div class="version-box">
        <select data-component="cobigen" class="select-version">
            <option value="1.0">
              1.0
            </option>
        </select>
      </div>
        <div data-component="cobigen" data-version="1.0" class="hide">
          <div class="nav-item is-link">
              <button class="nav-item-toggle"></button>
            <a  class="" href="../../cobigen/1.0/index.html">
              Cobigen
            </a>
          </div>
          <div class="nav-children-panel hide">
             
   
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Usage</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_usage">Usage of the eclipse UI</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-openapiplugin#usage">OpenAPI Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/howto_ionic-client-generation">Ionic/Cordova Client Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/howto_angular-client-generation">Angular Client Generation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-maven_configuration">Usage in Maven Builds</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-core_configuration">Configuration of the Templates</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Installation</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki/cobigen-eclipse_installation">For eclipse users</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Architecture</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a class="spacer" href="https://github.com/devonfw/cobigen/wiki#architecture">CobiGen is build as an extensible framework for incremental code generation&#8230;&#8203;</a>              </div>
                  </div>
              </div>
        </div>
    </div>
    <div class="nav-trees">
      <div class="version-box">
        <select data-component="devon4j" class="select-version">
            <option value="1.0">
              1.0
            </option>
        </select>
      </div>
        <div data-component="devon4j" data-version="1.0" class="hide">
          <div class="nav-item is-link">
              <button class="nav-item-toggle"></button>
            <a  class="" href="index.html">
              Devon4j
            </a>
          </div>
          <div class="nav-children-panel hide">
             
   
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Documentation</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="architecture.html">Architecture Overview</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-domain-layer.html">Domain Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-logic-layer.html">Logic Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-service-layer.html">Service Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-batch-layer.html">Batch Layer</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-client-layer.html">Client Layer (GUI)</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Coding</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="coding-conventions.html">Coding Conventions</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="coding-tools.html">Development Tools</a>              </div>
                  </div>
     
     
      <div class="nav-item ">
        <button class="nav-item-toggle"></button>
         
          <span class="">Guides</span>
      </div>
       
        <div class="nav-children-panel hide">
           
   
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-dependency-injection.html">Bean Dependency Injection</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-configuration.html">Configuration</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-logging.html">Logging</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-exceptions.html">Exception Handling</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-i18n.html">Internationalization (I18N)</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-transferobject.html">Transferobjects</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-beanmapping.html">Bean-Mapping</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-datatype.html">Datatypes</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-xml.html">XML</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-json.html">JSON</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-rest.html">REST</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-soap.html">SOAP</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-service-client.html">Service Client</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-kafka.html">Kafka</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-validation.html">Validation</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-security.html">Security</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-access-control.html">Access Control</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-testing.html">Testing</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-transactions.html">Transaction Handling</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-aop.html">AOP</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-jpa.html">JPA</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-repository.html">Repository</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-dao.html">DAO</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-jpa-query.html">Queries</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-jpa-performance.html">JPA Performance</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer is-current-page" href="guide-auditing.html">Auditing</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-database-migration.html">Database Migration</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-accessibility.html">Accessibility</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-caching.html">Caching</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-cors-support.html">CORS support</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-blob-support.html">BLOB support</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-sql.html">SQL</a>              </div>
           
     
      <div class="nav-item is-link">
        
          
            <a  class="spacer" href="guide-apm.html">Application Performance Management</a>              </div>
                  </div>
              </div>
        </div>
    </div>
   </div>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Devon4j</a></li>
    <li>Guides</li>
    <li><a href="guide-auditing.html">Auditing</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rafaelvicariabarker/devon4j/edit/refactorForAntora/modules/ROOT/pages/guide-auditing.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_auditing">Auditing</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_auditing"><a class="anchor" href="#_auditing"></a>Auditing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For database auditing we use <a href="http://envers.jboss.org/">hibernate envers</a>. If you want to use auditing ensure you have the following dependency in your pom.xml:</p>
</div>
<div class="listingblock">
<div class="title"><strong>spring</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.devonfw.java.modules&lt;/groupId&gt;
  &lt;artifactId&gt;devon4j-jpa-envers&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>quarkus</strong></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-hibernate-envers&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following part applies only to spring applications. At this point, the Quarkus extension does not provide any additional configurations. For Quarkus applications, simply use the <code>@Audited</code> annotation to enable auditing for an entity class, as described a few lines below or seen <a href="https://hibernate.org/orm/envers/">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make sure that entity manager also scans the package from the devon4j-jpa[-envers] module in order to work properly. And make sure that correct Repository Factory Bean Class is chosen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@EntityScan(basePackages = { "«my.base.package»" }, basePackageClasses = { AdvancedRevisionEntity.class })
...
@EnableJpaRepositories(repositoryFactoryBeanClass = GenericRevisionedRepositoryFactoryBean.class)
...
public class SpringBootApp {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let your [Entity]Repository extend from DefaultRevisionedRepository instead of DefaultRepository.</p>
</div>
<div class="paragraph">
<p>The repository now has a method getRevisionHistoryMetadata(id) and getRevisionHistoryMetadata(id, boolean lazy) available to get a list of revisions for a given entity and a method find(id, revision) to load a specific revision of an entity with the given ID or getLastRevisionHistoryMetadata(id) to load last revision.
To enable auditing for a entity simply place the @Audited annotation to your entity and all entity classes it extends from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity(name = "Drink")
@Audited
public class DrinkEntity extends ProductEntity implements Drink {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When auditing is enabled for an entity an additional database table is used to store all changes to the entity table and a corresponding revision number. This table is called &lt;ENTITY_NAME&gt;_AUD per default. Another table called REVINFO is used to store all revisions. Make sure that these tables are available. They can be generated by hibernate with the following property (only for development environments).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">  database.hibernate.hbm2ddl.auto=create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another possibility is to put them in your <a href="guide-database-migration.html" class="xref page">database migration</a> scripts like so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">CREATE CACHED TABLE PUBLIC.REVINFO(
  id BIGINT NOT NULL generated by default as identity (start with 1),
  timestamp BIGINT NOT NULL,
  user VARCHAR(255)
);
...
CREATE CACHED TABLE PUBLIC.&lt;TABLE_NAME&gt;_AUD(
    &lt;ALL_TABLE_ATTRIBUTES&gt;,
    revtype TINYINT,
    rev BIGINT NOT NULL
);</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
